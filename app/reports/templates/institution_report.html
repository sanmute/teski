<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Teski Learning Climate Report - {{ summary.institution_name }}</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 12px;
      color: #111827;
      margin: 2rem;
    }
    h1, h2, h3 {
      margin: 0 0 0.5rem 0;
    }
    h1 {
      font-size: 20px;
    }
    h2 {
      font-size: 16px;
      margin-top: 1.5rem;
    }
    .muted {
      color: #6b7280;
      font-size: 11px;
    }
    .section {
      margin-bottom: 1.5rem;
    }
    .grid-2 {
      display: flex;
      gap: 1.5rem;
    }
    .card {
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
      flex: 1;
    }
    .stat-label {
      font-size: 11px;
      color: #6b7280;
    }
    .stat-value {
      font-size: 16px;
      font-weight: 600;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.5rem;
    }
    th, td {
      padding: 0.35rem 0.5rem;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      font-size: 11px;
    }
    th {
      background-color: #f9fafb;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <section class="section">
    <h1>Teski Learning Climate Report</h1>
    <p class="muted">
      Institution: {{ summary.institution_name }} · Period: {{ summary.period_start }} – {{ summary.period_end }} · Generated at: {{ generated_at }}
    </p>

    <div class="grid-2">
      <div class="card">
        <div class="stat-label">Consenting students</div>
        <div class="stat-value">{{ summary.consenting_students }}</div>
        <div class="stat-label">Students who opted into anonymous learning analytics.</div>
      </div>
      <div class="card">
        <div class="stat-label">Active students (period)</div>
        <div class="stat-value">{{ summary.active_students }}</div>
        <div class="stat-label">Students with at least one recorded study session in this period.</div>
      </div>
    </div>

    <div class="grid-2" style="margin-top: 0.75rem;">
      <div class="card">
        <div class="stat-label">Total study minutes</div>
        <div class="stat-value">{{ summary.total_study_minutes }}</div>
        {% if summary.total_minutes_trend %}
        <div class="stat-label">
          Compared to previous period:
          {% if summary.total_minutes_trend.direction == "up" %}↑ more{% elif summary.total_minutes_trend.direction == "down" %}↓ less{% else %}→ similar{% endif %}
        </div>
        {% endif %}
      </div>
      <div class="card">
        <div class="stat-label">Avg minutes per active student</div>
        <div class="stat-value">{{ "%.1f"|format(summary.avg_minutes_per_active_student) }}</div>
        {% if summary.active_students_trend %}
        <div class="stat-label">
          Active students:
          {% if summary.active_students_trend.direction == "up" %}↑ more{% elif summary.active_students_trend.direction == "down" %}↓ fewer{% else %}→ similar{% endif %}
        </div>
        {% endif %}
      </div>
    </div>
  </section>

  <section class="section">
    <h2>Workload distribution by weekday</h2>
    <p class="muted">
      How total study minutes were distributed across the week.
    </p>

    <table>
      <thead>
        <tr>
          <th>Weekday</th>
          <th>Minutes</th>
          <th>Share of total</th>
        </tr>
      </thead>
      <tbody>
        {% set total_weekday_minutes = 0 %}
        {% for wd, mins in workload.minutes_by_weekday.items() %}
          {% set total_weekday_minutes = total_weekday_minutes + mins %}
        {% endfor %}

        {% for wd in range(0, 7) %}
          {% set mins = workload.minutes_by_weekday.get(wd, 0) %}
          {% if total_weekday_minutes > 0 %}
            {% set share = (mins / total_weekday_minutes) * 100 %}
          {% else %}
            {% set share = 0 %}
          {% endif %}
          <tr>
            <td>
              {% if wd == 0 %}Monday{% elif wd == 1 %}Tuesday{% elif wd == 2 %}Wednesday{% elif wd == 3 %}Thursday{% elif wd == 4 %}Friday{% elif wd == 5 %}Saturday{% else %}Sunday{% endif %}
            </td>
            <td>{{ mins }}</td>
            <td>{{ "%.1f"|format(share) }} %</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <p class="muted" style="margin-top: 0.5rem;">
      High concentration on one or two days can indicate last-minute clustering. More even distribution usually reflects healthier workload pacing.
    </p>
  </section>

  <section class="section">
    <h2>Top courses by study time (period)</h2>
    <p class="muted">
      Courses that accounted for the largest share of recorded study minutes in this period.
    </p>

    {% if course_load.top_courses %}
    <table>
      <thead>
        <tr>
          <th>Course</th>
          <th>Minutes</th>
          <th>Share of course time</th>
        </tr>
      </thead>
      <tbody>
        {% for item in course_load.top_courses %}
        <tr>
          <td>{{ item.course_name }}</td>
          <td>{{ item.minutes }}</td>
          <td>{{ "%.1f"|format(item.share_of_total * 100) }} %</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="muted">No course-specific data available for this period.</p>
    {% endif %}

    <p class="muted" style="margin-top: 0.5rem;">
      A single course dominating most of the time can signal a bottleneck. Low time on core courses may indicate disengagement.
    </p>
  </section>

  <section class="section">
    <h2>Methodology & privacy</h2>
    <p class="muted">
      This report is based on anonymous, aggregated study sessions recorded in Teski. Only students who opted in to anonymous learning analytics are included. No individual-level data is shared, and nothing in this report can be used to identify specific students.
    </p>
  </section>
</body>
</html>
